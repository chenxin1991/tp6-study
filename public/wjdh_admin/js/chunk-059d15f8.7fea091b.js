(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-059d15f8"],{2909:function(t,e,a){"use strict";a.d(e,"a",(function(){return c}));var n=a("6b75");function o(t){if(Array.isArray(t))return Object(n["a"])(t)}a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("d3b7"),a("3ca3"),a("ddb0");function r(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}var s=a("06c5");function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return o(t)||r(t)||Object(s["a"])(t)||i()}},2934:function(t,e,a){"use strict";a.d(e,"e",(function(){return r})),a.d(e,"a",(function(){return s})),a.d(e,"c",(function(){return i})),a.d(e,"f",(function(){return c})),a.d(e,"d",(function(){return l})),a.d(e,"b",(function(){return u}));var n=a("b775"),o={role:"/common/getRoles",car:"/common/getCars",goods:"/common/getGoods",setting:"/common/getSetting",leader:"/common/getLeaders",category:"/common/getCategory"};function r(t){return Object(n["b"])({url:o.role,method:"get",params:t})}function s(t){return Object(n["b"])({url:o.car,method:"get",params:t})}function i(t){return Object(n["b"])({url:o.goods,method:"get",params:t})}function c(t){return Object(n["b"])({url:o.setting,method:"get",params:t})}function l(t){return Object(n["b"])({url:o.leader,method:"get",params:t})}function u(t){return Object(n["b"])({url:o.category,method:"get",params:t})}},"4a4d":function(t,e,a){"use strict";var n=a("83f2"),o=a.n(n);o.a},"83f2":function(t,e,a){},"88bc":function(t,e,a){(function(e){var a=1/0,n=9007199254740991,o="[object Arguments]",r="[object Function]",s="[object GeneratorFunction]",i="[object Symbol]",c="object"==typeof e&&e&&e.Object===Object&&e,l="object"==typeof self&&self&&self.Object===Object&&self,u=c||l||Function("return this")();function d(t,e,a){switch(a.length){case 0:return t.call(e);case 1:return t.call(e,a[0]);case 2:return t.call(e,a[0],a[1]);case 3:return t.call(e,a[0],a[1],a[2])}return t.apply(e,a)}function m(t,e){var a=-1,n=t?t.length:0,o=Array(n);while(++a<n)o[a]=e(t[a],a,t);return o}function f(t,e){var a=-1,n=e.length,o=t.length;while(++a<n)t[o+a]=e[a];return t}var p=Object.prototype,h=p.hasOwnProperty,v=p.toString,g=u.Symbol,b=p.propertyIsEnumerable,_=g?g.isConcatSpreadable:void 0,y=Math.max;function C(t,e,a,n,o){var r=-1,s=t.length;a||(a=O),o||(o=[]);while(++r<s){var i=t[r];e>0&&a(i)?e>1?C(i,e-1,a,n,o):f(o,i):n||(o[o.length]=i)}return o}function k(t,e){return t=Object(t),x(t,e,(function(e,a){return a in t}))}function x(t,e,a){var n=-1,o=e.length,r={};while(++n<o){var s=e[n],i=t[s];a(i,s)&&(r[s]=i)}return r}function w(t,e){return e=y(void 0===e?t.length-1:e,0),function(){var a=arguments,n=-1,o=y(a.length-e,0),r=Array(o);while(++n<o)r[n]=a[e+n];n=-1;var s=Array(e+1);while(++n<e)s[n]=a[n];return s[e]=r,d(t,this,s)}}function O(t){return I(t)||j(t)||!!(_&&t&&t[_])}function S(t){if("string"==typeof t||E(t))return t;var e=t+"";return"0"==e&&1/t==-a?"-0":e}function j(t){return R(t)&&h.call(t,"callee")&&(!b.call(t,"callee")||v.call(t)==o)}var I=Array.isArray;function G(t){return null!=t&&q(t.length)&&!L(t)}function R(t){return $(t)&&G(t)}function L(t){var e=D(t)?v.call(t):"";return e==r||e==s}function q(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}function D(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function $(t){return!!t&&"object"==typeof t}function E(t){return"symbol"==typeof t||$(t)&&v.call(t)==i}var T=w((function(t,e){return null==t?{}:k(t,m(C(e,1),S))}));t.exports=T}).call(this,a("c8ba"))},"95a7":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"订单号/客户名/手机号"}},[a("a-input",{nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$refs.table.refresh(!0)}},model:{value:t.queryParam.keyword,callback:function(e){t.$set(t.queryParam,"keyword",e)},expression:"queryParam.keyword"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"下单日期"}},[a("a-range-picker")],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"预约日期"}},[a("a-range-picker")],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"订单来源"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("来电")]),a("a-select-option",{attrs:{value:"1"}},[t._v("上门")]),a("a-select-option",{attrs:{value:"2"}},[t._v("小程序")])],1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"订单状态"}},[a("a-select",{attrs:{placeholder:"请选择","default-value":"0"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("待确认")]),a("a-select-option",{attrs:{value:"1"}},[t._v("待派单")]),a("a-select-option",{attrs:{value:"2"}},[t._v("待开工")]),a("a-select-option",{attrs:{value:"3"}},[t._v("待完工")]),a("a-select-option",{attrs:{value:"4"}},[t._v("待评价")]),a("a-select-option",{attrs:{value:"5"}},[t._v("已关闭")]),a("a-select-option",{attrs:{value:"6"}},[t._v("已取消")])],1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"支付状态"}},[a("a-select",{attrs:{placeholder:"请选择"},model:{value:t.queryParam.status,callback:function(e){t.$set(t.queryParam,"status",e)},expression:"queryParam.status"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("未支付")]),a("a-select-option",{attrs:{value:"1"}},[t._v("已支付")])],1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.$refs.table.refresh(!0)}}},[t._v("查询")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return t.queryParam={}}}},[t._v("重置")])],1)])],1)],1)],1),a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.handleAdd()}}},[t._v("新建")])],1),a("s-table",{ref:"table",attrs:{size:"small",rowKey:"id",columns:t.columns,data:t.loadData},scopedSlots:t._u([{key:"source",fn:function(e){return["1"==e?[t._v("来电")]:t._e(),"2"==e?[t._v("上门")]:t._e(),"3"==e?[t._v("小程序")]:t._e()]}},{key:"action",fn:function(e,n){return a("span",{},[[a("a",{on:{click:function(e){return t.handleEdit(n)}}},[t._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-dropdown",[a("a",{staticClass:"ant-dropdown-link"},[t._v(" 更多 "),a("a-icon",{attrs:{type:"down"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",[a("a",{on:{click:function(e){return t.handleDispatch(n)}}},[t._v("派单")])]),a("a-menu-item",[a("a",{on:{click:function(e){return t.handleGrap(n)}}},[t._v("抢单")])]),a("a-menu-item",[a("a",{on:{click:function(e){return t.handleDelete(n)}}},[t._v("删除")])])],1)],1)]],2)}}])}),a("resident-form",{ref:"residentForm",on:{ok:t.handleOk}}),a("dispatch-form",{ref:"dispatchForm",on:{ok:t.handleOk}}),a("grap-form",{ref:"grapForm",on:{ok:t.handleOk}})],1)},o=[],r=a("2af9"),s=function(){var t=this,e=this,a=e.$createElement,n=e._self._c||a;return n("a-modal",{attrs:{title:e.config.title,width:1e3,visible:e.visible,confirmLoading:e.confirmLoading,bodyStyle:{padding:"24px 24px 12px 24px"}},on:{cancel:e.handleCancel}},[n("template",{slot:"footer"},[n("h2",{staticStyle:{dispaly:"inline",float:"left",color:"red"}},[e._v("总报价："+e._s(e.totalCost)+"元")]),n("a-button",{key:"back",on:{click:e.handleCancel}},[e._v(" 取消 ")]),n("a-button",{key:"submit",attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.handleSubmit}},[e._v(" 确定 ")])],1),n("a-form",{attrs:{form:e.form,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[n("a-tabs",{attrs:{"default-active-key":"1",tabPosition:"left"}},[n("a-tab-pane",{key:"1",attrs:{tab:"预约与车辆",forceRender:""}},[n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"订单来源",labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["source",{rules:[{required:!0,message:"请选择订单来源！"}]}],expression:"['source', { rules: [{ required: true, message: '请选择订单来源！' }] }]"}],attrs:{placeholder:"请选择"}},[n("a-select-option",{attrs:{value:"1"}},[e._v("来电")]),n("a-select-option",{attrs:{value:"2"}},[e._v("上门")]),n("a-select-option",{attrs:{value:"3"}},[e._v("小程序")])],1)],1)],1),n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"客户名",labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["customer",{rules:[{required:!0,message:"请输入客户名！"}]}],expression:"['customer',{ rules: [{ required: true, message: '请输入客户名！' }] }]"}]})],1)],1),n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"联系电话",labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone",{rules:[{required:!0,message:"请输入联系电话！"}]}],expression:"['phone',{ rules: [{ required: true, message: '请输入联系电话！' }] }]"}]})],1)],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"预约日期",labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}}},[n("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["appointDate",{rules:[{required:!0,message:"请选择预约日期！"}]}],expression:"[\n                  'appointDate',\n                  {\n                    rules: [{ required: true, message: '请选择预约日期！' }],\n                  },\n                ]"}],staticStyle:{width:"100%"}})],1)],1),n("a-col",{attrs:{span:8}},[n("a-form-item",{attrs:{label:"时间段",labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}}},[n("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["appointTime",{rules:[{required:!0,message:"请选择时间段！"}]}],expression:"['appointTime', { rules: [{ required: true, message: '请选择时间段！' }] }]"}],attrs:{placeholder:"请选择时间段"},on:{change:function(e){return t.appointTime=e}}},e._l(e.times,(function(t){return n("a-select-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1)],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{labelCol:{xs:{span:24},sm:{span:0}},wrapperCol:{xs:{span:24},sm:{span:24}}}},[n("a-button",{staticClass:"editable-add-btn",on:{click:e.handleCarAdd}},[e._v(" 添加车辆 ")]),n("a-table",{attrs:{columns:e.columns_car,"data-source":e.selectCar,pagination:!1,size:"small"},scopedSlots:e._u([{key:"id",fn:function(t,a){return[n("a-select",{attrs:{"show-search":"",value:t,placeholder:"选择车辆","filter-option":e.filterGoods},on:{change:function(t,n){return e.handleCarIDChange(t,a.key,n)}}},e._l(e.car,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.id,option:{price:t.price,item:t}}},[e._v(e._s(t.name))])})),1)]}},{key:"num",fn:function(t,a){return[n("a-input-number",{staticStyle:{width:"100%"},attrs:{value:t,min:1,max:10},on:{change:function(t){return e.handleCarNumChange(t,a.key)}}})]}},{key:"action",fn:function(t,a){return n("span",{},[[e.selectCar.length?n("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(){return e.handleCarDelete(a.key)}}},[n("a",{attrs:{href:"javascript:;"}},[e._v("删除")])]):e._e()]],2)}}])})],1)],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"车辆费用"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.carCost)+"元 ")])])],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{labelCol:{xs:{span:24},sm:{span:12}},wrapperCol:{xs:{span:24},sm:{span:12}},label:"特殊时间段费用"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.specialTimeCost)+"元 ")])])],1)],1)],1),n("a-tab-pane",{key:"2",attrs:{tab:"起始地",forceRender:""}},[n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{labelCol:{xs:{span:24},sm:{span:0}},wrapperCol:{xs:{span:24},sm:{span:24}}}},[n("a-button",{staticClass:"editable-add-btn",on:{click:e.handleRouteAdd}},[e._v(" 添加途径点 ")]),n("a-table",{attrs:{columns:e.columns_route,"data-source":e.route,pagination:!1,size:"small"},scopedSlots:e._u([{key:"floor_num",fn:function(t,a){return[n("a-input-number",{staticStyle:{width:"100%"},attrs:{value:t,min:0,max:100},on:{change:function(t){return e.handleRouteChange(t,a.key,"floor_num")}}})]}},{key:"parking_distance",fn:function(t,a){return[n("a-select",{attrs:{value:t,placeholder:"选择距离"},on:{change:function(t){return e.handleRouteChange(t,a.key,"parking_distance")}}},[n("a-select-option",{attrs:{value:"0"}},[e._v("低于30米")]),n("a-select-option",{attrs:{value:"1"}},[e._v("30-50米")]),n("a-select-option",{attrs:{value:"2"}},[e._v("50-100米")]),n("a-select-option",{attrs:{value:"3"}},[e._v("100米以上")]),n("a-select-option",{attrs:{value:"4"}},[e._v("地下室出入")])],1)]}},{key:"location",fn:function(t,a){return[n("a-auto-complete",{attrs:{value:t,placeholder:a.placeholder,"dropdown-match-select-width":!1,"dropdown-style":{width:"800px"},optionLabelProp:"title"},on:{search:function(t){return e.onLocationSearch(t,a.key)},select:function(t,n){return e.onLocationSelect(t,n,a.key)},change:function(t){return e.onLocationChange(t,a.key)},blur:function(t){return e.onLacationBlur(a.key)}}},[n("template",{slot:"dataSource"},e._l(e.places,(function(t){return n("a-select-option",{key:t.id,attrs:{title:t.title,option:{title:t.title,location:t.location,address:t.address}}},[n("span",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(t.title))]),n("span",{staticStyle:{"padding-left":"10px"}},[e._v(e._s(t.address))])])})),1)],2)]}},{key:"room_number",fn:function(t,a){return[n("a-input",{attrs:{value:t},on:{change:function(t){return e.handleRouteChange(t.target.value,a.key,"room_number")}}},[e._v("/> ")])]}},{key:"stairs_or_elevators",fn:function(t,a){return[n("a-select",{attrs:{value:t,placeholder:"选择"},on:{change:function(t){return e.handleRouteChange(t,a.key,"stairs_or_elevators")}}},[n("a-select-option",{attrs:{value:"0"}},[e._v("电梯")]),n("a-select-option",{attrs:{value:"1"}},[e._v("楼梯")])],1)]}},{key:"action",fn:function(t,a){return n("span",{},[[e.route.length&&0!=a.key&&1!=a.key?n("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(){return e.handleRouteDelete(a.key)}}},[n("a",{attrs:{href:"javascript:;"}},[e._v("删除")])]):e._e()]],2)}}])})],1)],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"实际距离"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.distance||0)+"公里 ")])])],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"距离费用"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.distanceCost)+"元 ")])])],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"楼层费用"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.floorCost)+"元 ")])])],1),n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"停车距离费用"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.parkingCost)+"元 ")])])],1)],1)],1),n("a-tab-pane",{key:"3",attrs:{tab:"物品",forceRender:""}},[n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:24}},[n("a-form-item",{attrs:{labelCol:{xs:{span:24},sm:{span:0}},wrapperCol:{xs:{span:24},sm:{span:24}}}},[n("a-button",{staticClass:"editable-add-btn",on:{click:e.handleGoodsAdd}},[e._v(" 添加物品 ")]),n("a-table",{attrs:{columns:e.columns_goods,"data-source":e.selectGoods,pagination:!1,size:"small"},scopedSlots:e._u([{key:"id",fn:function(t,a){return[n("a-select",{attrs:{"show-search":"",value:t,placeholder:"选择物品","filter-option":e.filterGoods},on:{change:function(t,n){return e.handleGoodsIDChange(t,a.key,n)}}},e._l(e.goods,(function(t,a){return n("a-select-option",{key:a,attrs:{value:t.id,option:{price:t.price,name:t.name}}},[e._v(e._s(t.name))])})),1)]}},{key:"num",fn:function(t,a){return[n("a-input-number",{staticStyle:{width:"100%"},attrs:{value:t,min:1,max:10},on:{change:function(t){return e.handleGoodsNumChange(t,a.key)}}})]}},{key:"image",fn:function(t,a){return[n("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card","show-upload-list":!1,action:"/index.php/admin/test/avatar","before-upload":e.beforeUpload},on:{change:function(t){return e.handleImageChange(t,a.key)}}},[t?n("img",{staticStyle:{"max-width":"80px","max-height":"80px"},attrs:{src:t,alt:"avatar"}}):n("div",[n("a-icon",{attrs:{type:e.loading?"loading":"plus"}}),n("div",{staticClass:"ant-upload-text"},[e._v(" Upload ")])],1)])]}},{key:"action",fn:function(t,a){return n("span",{},[[e.selectGoods.length?n("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(){return e.handleGoodsDelete(a.key)}}},[n("a",{attrs:{href:"javascript:;"}},[e._v("删除")])]):e._e()]],2)}}])})],1)],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{attrs:{span:12}},[n("a-form-item",{attrs:{label:"物品费用"}},[n("span",{staticClass:"ant-form-text",staticStyle:{"font-size":"20px",color:"red"}},[e._v(" "+e._s(e.goodsCost)+"元 ")])])],1)],1)],1)],1)],1)],2)},i=[],c=(a("99af"),a("4de4"),a("4160"),a("caad"),a("c975"),a("a434"),a("b0c0"),a("d3b7"),a("25f0"),a("2532"),a("159b"),a("2909")),l=a("88bc"),u=a.n(l),d=a("c1df"),m=a.n(d),f=a("d871"),p=a.n(f),h=a("b775"),v={ResidentOrder:"/ResidentOrder"};function g(t){return Object(h["b"])({url:v.ResidentOrder,method:"post",data:t})}function b(t){return Object(h["b"])({url:v.ResidentOrder+"/"+t.id,method:"put",data:t})}function _(t){return Object(h["b"])({url:v.ResidentOrder+"/"+t.id,method:"delete",data:t})}function y(t){return Object(h["b"])({url:v.ResidentOrder,method:"get",params:t})}var C,k=a("2934");function x(t,e){function a(){p()("https://apis.map.qq.com/ws/place/v1/suggestion/?region=深圳&region_fix=0&output=jsonp&keyword="+t+"&key=OI7BZ-EGOWU-H5YVZ-4HLVW-MDUUQ-ZCFGJ").then((function(t){return t.json()})).then((function(t){var a=t.data,n=[];a.forEach((function(t){t.address.includes(t.province)||(t.address.hasOwnProperty("district")?t.address=t.province+t.city+t.district+t.address:t.address=t.province+t.city+t.address),n.push({id:t.id,title:t.title,province:t.province,city:t.city,district:t.district,location:JSON.stringify(t.location),address:t.address})})),e(n)}))}C&&(clearTimeout(C),C=null),C=setTimeout(a,300)}function w(t,e){var a="",n="",o="",r="",s=0;t.forEach((function(t){0===t.key?a=t.location.lat+","+t.location.lng:1===t.key?n=t.location.lat+","+t.location.lng:o=o?o+";"+t.location.lat+","+t.location.lng:t.location.lat+","+t.location.lng})),a&&n&&(r="https://apis.map.qq.com/ws/direction/v1/driving/?from="+a+"&to="+n+"&output=jsonp&key=OI7BZ-EGOWU-H5YVZ-4HLVW-MDUUQ-ZCFGJ",o&&(r=r+"&waypoints="+o),p()(r).then((function(t){return t.json()})).then((function(t){if(0===t.status){var a=t.result.routes[0];s=Math.round(a.distance/1e3),e(s)}else e(s)})).catch((function(t){e(s)})))}var O={data:function(){return{columns_car:[{title:"车型",dataIndex:"id",width:"40%",scopedSlots:{customRender:"id"}},{title:"单价",dataIndex:"price"},{title:"数量",dataIndex:"num",scopedSlots:{customRender:"num"}},{title:"总计",dataIndex:"total"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],columns_route:[{title:"地址",dataIndex:"title",width:"37%",scopedSlots:{customRender:"location"}},{title:"门牌号",dataIndex:"room_number",width:"20%",scopedSlots:{customRender:"room_number"}},{title:"电梯或楼梯",dataIndex:"stairs_or_elevators",scopedSlots:{customRender:"stairs_or_elevators"},width:"90px"},{title:"楼层数",dataIndex:"floor_num",scopedSlots:{customRender:"floor_num"},width:"80px"},{title:"停车位距离",dataIndex:"parking_distance",scopedSlots:{customRender:"parking_distance"},width:"120px"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],columns_goods:[{title:"名称",dataIndex:"id",width:"40%",scopedSlots:{customRender:"id"}},{title:"单价",dataIndex:"price",width:"15%"},{title:"数量",dataIndex:"num",width:"15%",scopedSlots:{customRender:"num"}},{title:"总计",dataIndex:"total"},{title:"图片",dataIndex:"image_url",scopedSlots:{customRender:"image"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),config:{},times:["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00"],appointTime:"",car:[],selectCar:[],places:[],distance:0,route:[{key:0,title:"",address:"",location:"",room_number:"",stairs_or_elevators:void 0,floor_num:"",parking_distance:void 0,placeholder:"请输入起点"},{key:1,title:"",address:"",location:"",room_number:"",stairs_or_elevators:void 0,floor_num:"",parking_distance:void 0,placeholder:"请输入起点"}],goods:[],selectGoods:[],carCount:0,routeCount:2,goodsCount:0,setting:{},loading:!1}},created:function(){var t=this;Object(k["a"])({t:new Date}).then((function(e){t.car=e})),Object(k["c"])({t:new Date}).then((function(e){t.goods=e})),Object(k["f"])({t:new Date}).then((function(e){t.setting=e}))},computed:{carCost:function(){var t=0;return this.selectCar.forEach((function(e){e.id>0&&(t+=e.total)})),Math.round(t)},distanceCost:function(){var t=this,e=0;return this.selectCar.forEach((function(a){a.id>0&&(t.distance>parseFloat(a.km_standard)&&t.distance<=300?e+=a.km_price*(t.distance-a.km_standard)*a.num:t.distance>300&&t.distance<=500?e+=a.km_price*(t.distance-a.km_standard)*a.num*t.setting.discount1/10:t.distance>500&&(e+=a.km_price*(t.distance-a.km_standard)*a.num*t.setting.discount2/10))})),Math.round(e)},floorCost:function(){var t=0,e=[];return this.route.forEach((function(t){t.location&&t.floor_num>0&&"1"===t.stairs_or_elevators&&e.push(t.floor_num)})),e.length>0&&this.selectCar.forEach((function(a){if(a.id>0)for(var n=0;n<e.length;n++)a.floor_standard<=e[n]&&(t+=(e[n]-a.floor_standard+1)*a.floor_price*a.num)})),Math.round(t)},parkingCost:function(){var t=0,e=[];return this.route.forEach((function(t){t.location&&t.parking_distance>=0&&e.push(t.parking_distance)})),e.length>0&&this.selectCar.forEach((function(a){if(a.id>0)for(var n=0;n<e.length;n++)switch(e[n]){case"0":t+=a.distance1*a.num;break;case"1":t+=a.distance2*a.num;break;case"2":t+=a.distance3*a.num;break;case"3":case"4":t+=a.distance4*a.num;break}})),Math.round(t)},goodsCost:function(){var t=0;return this.selectGoods.forEach((function(e){e.id>0&&(t+=e.total)})),Math.round(t)},specialTimeCost:function(){var t=0;return this.time&&(this.time>="19:00"&&this.time<="23:00"?t=this.setting.add_ratio1/100*(this.carCost+this.distanceCost+this.floorCost+this.parkingCost+this.goodsCost):(this.time>"23:00"||this.time<="07:00")&&(t=this.setting.add_ratio2/100*(this.carCost+this.distanceCost+this.floorCost+this.parkingCost+this.goodsCost))),Math.round(t)},totalCost:function(){return this.carCost+this.distanceCost+this.floorCost+this.parkingCost+this.goodsCost+this.specialTimeCost}},methods:{moment:m.a,add:function(){var t=this;this.config.action="add",this.config.title="新增订单",this.visible=!0,this.$nextTick((function(){t.form.resetFields(),t.selectCar=[],t.route=[{key:0,title:"",address:"",location:"",room_number:"",stairs_or_elevators:void 0,floor_num:"",parking_distance:void 0,placeholder:"请输入起点"},{key:1,title:"",address:"",location:"",room_number:"",stairs_or_elevators:void 0,floor_num:"",parking_distance:void 0,placeholder:"请输入终点"}],t.selectGoods=[],t.distance=0,t.time=""}))},edit:function(t){var e=this;this.config.action="edit",this.config.title="修改订单",this.config.id=t.id,this.visible=!0;var a=this.form.setFieldsValue;this.$nextTick((function(){var n=u()(t,["source","customer","phone","appointTime"]);n.source=n.source.toString(),n.appointDate=m()(t.appointDate),a(n),e.time=t.time,e.selectCar=JSON.parse(JSON.stringify(t.cars)),e.carCount=t.cars.length,e.route=JSON.parse(JSON.stringify(t.routes)),e.routeCount=t.routes.length,e.distance=t.distance,e.selectGoods=JSON.parse(JSON.stringify(t.goods)),e.goodsCount=t.goods.length}))},handleCarAdd:function(){var t=this.selectCar,e=this.carCount,a={key:e,id:void 0,name:"",price:0,num:1,total:0,km_price:0,floor_standard:0,floor_price:0,distance1:0,distance2:0,distance3:0,distance4:0};this.selectCar=[].concat(Object(c["a"])(t),[a]),this.carCount=e+1},handleCarIDChange:function(t,e,a){var n=Object(c["a"])(this.selectCar),o=n.filter((function(t){return e===t.key}))[0],r=a.data.attrs.option.item;o&&(o["id"]=t,o["name"]=r.name,o["price"]=r.price,o["km_price"]=r.km_price,o["km_standard"]=r.km_standard,o["floor_price"]=r.floor_price,o["floor_standard"]=r.floor_standard,o["distance1"]=r.distance1,o["distance2"]=r.distance2,o["distance3"]=r.distance3,o["distance4"]=r.distance4,o["total"]=o["price"]*o["num"],this.selectCar=n)},handleCarNumChange:function(t,e){var a=Object(c["a"])(this.selectCar),n=a.filter((function(t){return e===t.key}))[0];n&&(n["num"]=t,n["total"]=n["num"]*n["price"],this.selectCar=a)},handleCarDelete:function(t){this.selectCar=this.selectCar.filter((function(e){return e.key!==t}))},onLocationSearch:function(t,e){var a=this;t&&x(t,(function(t){return a.places=t}))},onLocationSelect:function(t,e,a){var n=this,o=!0,r=e.data.attrs.option,s=Object(c["a"])(this.route),i=s.filter((function(t){return a===t.key}))[0];i&&(i["title"]=r.title,i["location"]=JSON.parse(r.location),i["address"]=r.address,i["select_title"]=r.title,this.route=s),this.route.forEach((function(t){t.location||(o=!1)})),o&&w(this.route,(function(t){return n.distance=t}))},onLocationChange:function(t,e){var a=Object(c["a"])(this.route),n=a.filter((function(t){return e===t.key}))[0];n&&(n["title"]=t,this.route=a)},onLacationBlur:function(t){var e=Object(c["a"])(this.route),a=e.filter((function(e){return t===e.key}))[0];a&&(a["select_title"]!==a["title"]&&(a["title"]=a["select_title"]),this.route=e)},handleRouteChange:function(t,e,a){var n=Object(c["a"])(this.route),o=n.filter((function(t){return e===t.key}))[0];o&&(o[a]=t,this.route=n)},handleRouteAdd:function(){var t=this.routeCount,e={key:t,title:"",address:"",location:"",room_number:"",stairs_or_elevators:"",floor_num:"",parking_distance:"",placeholder:"请输入途径点"};this.route.splice(-1,0,e),this.routeCount=t+1},handleRouteDelete:function(t){var e=this,a=!0;this.route=this.route.filter((function(e){return e.key!==t})),this.route.forEach((function(t){t.location||(a=!1)})),a&&w(this.route,(function(t){return e.distance=t}))},handleGoodsAdd:function(){var t=this.selectGoods,e=this.goodsCount,a={key:e,id:void 0,name:"",price:0,num:1,total:0};this.selectGoods=[].concat(Object(c["a"])(t),[a]),this.goodsCount=e+1},handleGoodsIDChange:function(t,e,a){var n=Object(c["a"])(this.selectGoods),o=n.filter((function(t){return e===t.key}))[0];o&&(o["id"]=t,o["name"]=a.data.attrs.option.name,o["price"]=a.data.attrs.option.price,o["total"]=o["price"]*o["num"],this.selectGoods=n)},handleGoodsNumChange:function(t,e){var a=Object(c["a"])(this.selectGoods),n=a.filter((function(t){return e===t.key}))[0];n&&(n["num"]=t,n["total"]=n["num"]*n["price"],this.selectGoods=a)},handleImageChange:function(t,e){if("done"===t.file.status&&"done"===t.file.response.status){var a=Object(c["a"])(this.selectGoods),n=a.filter((function(t){return e===t.key}))[0];n&&(n["image_url"]=t.file.response.url,this.selectGoods=a)}},beforeUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type;e||this.$message.error("You can only upload JPG file!");var a=t.size/1024/1024<2;return a||this.$message.error("Image must smaller than 2MB!"),e&&a},handleGoodsDelete:function(t){this.selectGoods=this.selectGoods.filter((function(e){return e.key!==t}))},filterGoods:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},handleCancel:function(){this.visible=!1},handleSubmit:function(){var t=this,e=this.form.validateFields,a=this.$message;e((function(e,n){if(!e){n.appointDate=n.appointDate.format("YYYY-MM-DD");var o=[],r=!0;if(t.selectCar.forEach((function(t){t.key>=0&&t.id>0&&t.num>0?o.push(t):r=!1})),!o.length||!r)return a.error("请检查车辆信息是否填写完整!"),!1;n.cars=o;var s=[],i=!0;if(t.route.forEach((function(t){t.key>=0&&t.location&&t.room_number&&t.title&&t.address&&t.floor_num&&t.parking_distance&&t.stairs_or_elevators?s.push(t):i=!1})),!s.length||!i)return a.error("请检查路线信息是否填写完整!"),!1;n.routes=s;var c=[],l=!0;if(t.selectGoods.forEach((function(t){t.key>=0&&t.id&&t.name&&t.num>0?c.push(t):l=!1})),!l)return a.error("请检查拆装信息是否填写完整!"),!1;n.goods=c,n.distance=t.distance,n.carCost=t.carCost,n.distanceCost=t.distanceCost,n.floorCost=t.floorCost,n.parkingCost=t.parkingCost,n.goodsCost=t.goodsCost,n.specialTimeCost=t.specialTimeCost,n.totalCost=t.totalCost,"add"===t.config.action?g(n).then((function(e){a.success("添加成功"),t.visible=!1,t.confirmLoading=!1,t.$emit("ok",n)})).catch((function(t){a.error("load user err: ".concat(t.message))})):"edit"===t.config.action&&(n.id=t.config.id,b(n).then((function(e){a.success("修改成功"),t.visible=!1,t.confirmLoading=!1,t.$emit("ok",n)})).catch((function(t){a.error("load user err: ".concat(t.message))})))}}))}}},S=O,j=(a("4a4d"),a("2877")),I=Object(j["a"])(S,s,i,!1,null,"7d50b95c",null),G=I.exports,R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"派单",width:600,visible:t.visible,confirmLoading:t.confirmLoading},on:{ok:t.handleSubmit,cancel:t.handleCancel}},[a("a-form",{attrs:{form:t.form}},[a("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"队长"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["leader",{rules:[{required:!0,message:"请选择队长!"}]}],expression:"['leader',{ rules: [{ required: true, message: '请选择队长!' }] }]"}],attrs:{"show-search":"","filter-option":t.filter}},t._l(t.leaders,(function(e,n){return a("a-select-option",{key:n,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1)],1)],1)},L=[],q={data:function(){return{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},visible:!1,confirmLoading:!1,form:this.$form.createForm(this),leaders:[]}},created:function(){var t=this;Object(k["d"])({t:new Date}).then((function(e){t.leaders=e}))},methods:{add:function(){this.visible=!0},edit:function(t){0===t.leader&&(t.leader=""),this.visible=!0;var e=this.form.setFieldsValue;this.$nextTick((function(){e(u()(t,["leader"]))}))},filter:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0},handleSubmit:function(){var t=this,e=this.form.validateFields;this.confirmLoading=!0,e((function(e,a){e?t.confirmLoading=!1:setTimeout((function(){t.visible=!1,t.confirmLoading=!1,t.$emit("ok",a)}),1500)}))},handleCancel:function(){this.visible=!1}}},D=q,$=Object(j["a"])(D,R,L,!1,null,null,null),E=$.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{title:"抢单",width:600,visible:t.visible,confirmLoading:t.confirmLoading},on:{ok:t.handleSubmit,cancel:t.handleCancel}},[a("a-form",{staticClass:"permission-form",attrs:{form:t.form}},[a("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"队长"}},[a("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple","default-value":["a1","b2"],placeholder:"Please select"}},t._l(25,(function(e){return a("a-select-option",{key:(e+9).toString(36)+e},[t._v(" "+t._s((e+9).toString(36)+e)+" ")])})),1)],1)],1)],1)},F=[],P={data:function(){return{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},visible:!1,confirmLoading:!1,form:this.$form.createForm(this)}},methods:{add:function(){this.visible=!0},edit:function(t){this.visible=!0;var e=this.form.setFieldsValue;this.$nextTick((function(){e(u()(t,[]))}))},handleSubmit:function(){var t=this,e=this.form.validateFields;this.confirmLoading=!0,e((function(e,a){e?t.confirmLoading=!1:setTimeout((function(){t.visible=!1,t.confirmLoading=!1,t.$emit("ok",a)}),1500)}))},handleCancel:function(){this.visible=!1}}},N=P,A=Object(j["a"])(N,T,F,!1,null,null,null),J=A.exports,M={name:"OrderResident",components:{STable:r["r"],ResidentForm:G,GrapForm:J,DispatchForm:E},data:function(){var t=this;return{queryParam:{},columns:[{title:"订单号",dataIndex:"number"},{title:"订单来源",dataIndex:"source",scopedSlots:{customRender:"source"}},{title:"下单时间",dataIndex:"create_time"},{title:"预约日期",dataIndex:"appointDate"},{title:"客户名",dataIndex:"customer"},{title:"联系电话",dataIndex:"phone"},{title:"总报价",dataIndex:"totalCost"},{title:"订单状态",dataIndex:"orderStatus"},{title:"支付状态",dataIndex:"payStatus"},{title:"接线员",dataIndex:"adminname"},{title:"队长",dataIndex:"leadername"},{title:"操作",dataIndex:"action",width:"150px",scopedSlots:{customRender:"action"}}],loadData:function(e){return y(Object.assign(e,t.queryParam)).then((function(t){return t.result}))}}},methods:{handleAdd:function(){this.$refs.residentForm.add()},handleEdit:function(t){this.$refs.residentForm.edit(t)},handleDispatch:function(t){this.$refs.dispatchForm.edit(t)},handleGrap:function(t){this.$message.warning("功能暂未开放！")},handleDelete:function(t){var e=this;this.$confirm({title:"警告",content:"真的要删除 ".concat(t.number," 吗?"),okText:"删除",okType:"danger",cancelText:"取消",onOk:function(){_(t).then((function(t){e.$message.success("删除成功"),e.$refs.table.refresh()})).catch((function(t){e.$message.error("load user err: ".concat(t.message))}))}})},handleOk:function(){this.$refs.table.refresh()}}},z=M,B=Object(j["a"])(z,n,o,!1,null,null,null);e["default"]=B.exports},d871:function(t,e,a){var n,o,r;(function(a,s){o=[e,t],n=s,r="function"===typeof n?n.apply(e,o):n,void 0===r||(t.exports=r)})(0,(function(t,e){"use strict";var a={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function n(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function o(t){try{delete window[t]}catch(e){window[t]=void 0}}function r(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}function s(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=t,i=e.timeout||a.timeout,c=e.jsonpCallback||a.jsonpCallback,l=void 0;return new Promise((function(a,u){var d=e.jsonpCallbackFunction||n(),m=c+"_"+d;window[d]=function(t){a({ok:!0,json:function(){return Promise.resolve(t)}}),l&&clearTimeout(l),r(m),o(d)},s+=-1===s.indexOf("?")?"?":"&";var f=document.createElement("script");f.setAttribute("src",""+s+c+"="+d),e.charset&&f.setAttribute("charset",e.charset),f.id=m,document.getElementsByTagName("head")[0].appendChild(f),l=setTimeout((function(){u(new Error("JSONP request to "+t+" timed out")),o(d),r(m),window[d]=function(){o(d)}}),i),f.onerror=function(){u(new Error("JSONP request to "+t+" failed")),o(d),r(m),l&&clearTimeout(l)}}))}e.exports=s}))}}]);